<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Filtro de Lista M3U8</title>
<style>
  body {
    font-family: Arial, Helvetica, sans-serif;
    background-color: black;
    margin: 0;
    padding: 0;
    color: #1e1e1e;
  }
  .container {
    max-width: 900px;
    margin: auto;
    background: gray;
    padding: 25px;
    margin-top: 40px;
    margin-bottom: 40px;
    border-radius: 10px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.15);
  }
  h2 { text-align: center; }
  label { margin-top: 15px; display: block; font-weight: bold; }
  input[type="text"], input[type="file"] {
    width: 100%; padding: 10px; margin-top: 6px; border: 1px solid #ccc; border-radius: 6px;
  }
  button {
    margin-top: 12px; padding: 12px 18px; cursor: pointer; border: none;
    background: #10a37f; color: white; border-radius: 6px; transition: 0.3s;
  }
  button:hover { background: #0e8f6f; }
  textarea {
    width: 100%; height: 250px; margin-top: 15px; padding: 10px;
    border-radius: 6px; border: 1px solid #bbb; resize: vertical;
  }
  .category-list {
    background: #f7f7f7;
    padding: 12px;
    border-radius: 6px;
    max-height: 220px;
    overflow-y: auto;
    margin-top: 12px;
    border: 1px solid #ddd;
  }
</style>
</head>
<body>

<div class="container">
  <h2>ğŸ” Filtro de Lista M3U/M3U8</h2>

  <label>ğŸ“‚ Carregar Lista M3U/M3U8</label>
  <input type="file" id="fileInput" accept=".m3u,.m3u8">

  <label>ğŸ”‘ Palavras-chave (separe com vÃ­rgulas):</label>
  <input type="text" id="keywords" placeholder="Ex: esportes, filmes, notÃ­cias">

  <button onclick="processFile()">Filtrar Canais ğŸ¯</button>
  <button onclick="showCategories()">ğŸ“š Mostrar Categorias</button>
  <button onclick="downloadTxt()">â¬‡ï¸ Baixar Resultado TXT</button>
  <button onclick="copyResult()">ğŸ“‹ Copiar Resultado</button>

  <div id="categories" class="category-list" style="display:none;"></div>

  <h3>ğŸ“œ Resultado</h3>
  <textarea id="output" readonly></textarea>
</div>

<script>
let fileContent = "";

// Carregar arquivo
document.getElementById('fileInput').addEventListener('change', function(event) {
  const reader = new FileReader();
  reader.onload = e => fileContent = e.target.result;
  reader.readAsText(event.target.files[0]);
});

// Filtrar canais e remover duplicados
function processFile() {
  if (!fileContent) return alert("âš ï¸ Selecione uma lista primeiro!");
  const keywords = document.getElementById('keywords').value.toLowerCase().split(',').map(k => k.trim());
  const lines = fileContent.split("\n");
  const uniqueLinks = new Set();
  let result = "";

  for (let i = 0; i < lines.length; i++) {
    const line = lines[i].toLowerCase();
    if (line.includes("#extinf")) {
      const url = lines[i + 1]?.trim();
      if (url && !uniqueLinks.has(url) && keywords.some(k => k && line.includes(k))) {
        uniqueLinks.add(url);
        result += lines[i] + "\n" + url + "\n";
      }
    }
  }

  document.getElementById('output').value = result || "Nenhum canal encontrado.";
}

// Mostrar categorias
function showCategories() {
  if (!fileContent) return alert("âš ï¸ Carregue uma lista primeiro.");
  const regex = /group-title="([^"]+)"/g;
  let match, groups = new Set();

  while ((match = regex.exec(fileContent)) !== null) {
    groups.add(match[1]);
  }

  document.getElementById('categories').innerHTML =
    "<b>Categorias encontradas:</b><br><br>âœ… " + [...groups].join("<br>âœ… ");
  document.getElementById('categories').style.display = "block";
}

// Baixar resultado
function downloadTxt() {
  const text = document.getElementById('output').value;
  if (!text) return alert("âš ï¸ Nada para baixar.");
  const blob = new Blob([text], { type: "text/plain" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "resultado.txt";
  link.click();
}

// Copiar resultado
function copyResult() {
  const output = document.getElementById('output');
  if (!output.value) return alert("âš ï¸ Nada para copiar.");
  output.select();
  document.execCommand("copy");
  alert("âœ… Copiado para a Ã¡rea de transferÃªncia!");
}
</script>

</body>
</html>
